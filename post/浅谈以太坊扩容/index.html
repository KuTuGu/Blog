<!doctype html><html lang=en><head><title>浅谈以太坊扩容 :: KuTuGu's Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=" "><meta name=keywords content="以太坊,扩容"><meta name=robots content="noodp"><link rel=canonical href=../../post/%E6%B5%85%E8%B0%88%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%89%A9%E5%AE%B9/><link rel=stylesheet href=../../assets/style.css><link rel=stylesheet id=themeColor href=../../assets/orange.css><link rel=apple-touch-icon href=../../img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=../../img/favicon/icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="浅谈以太坊扩容"><meta property="og:description" content=" "><meta property="og:url" content="/post/%E6%B5%85%E8%B0%88%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%89%A9%E5%AE%B9/"><meta property="og:site_name" content="KuTuGu's Blog"><meta property="og:image" content="/img/favicon/icon.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-08-03 08:57:49 +0800 +0800"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=../../><div class=logo>Main</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=../../about>About</a></li><li><a href=https://github.com/KuTuGu>Github</a></li><li><a href=../../resume_en>Resume_en</a></li><li><a href=../../resume_zh>Resume_zh</a></li><li><a href=https://twitter.com/kutugu1>Twitter</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=../../about>About</a></li><li><a href=https://github.com/KuTuGu>Github</a></li><li><a href=../../resume_en>Resume_en</a></li><li><a href=../../resume_zh>Resume_zh</a></li><li><a href=https://twitter.com/kutugu1>Twitter</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=../../post/%E6%B5%85%E8%B0%88%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%89%A9%E5%AE%B9/>浅谈以太坊扩容</a></h1><div class=post-meta><span class=post-date>2021-08-03</span>
<span class=post-author>:: KuTuGu</span></div><span class=post-tags>#<a href=../../tags/%E5%8C%BA%E5%9D%97%E9%93%BE/>区块链</a>&nbsp;</span><div class=post-content><div><h1 id=浅谈以太坊扩容>浅谈以太坊扩容<a href=#浅谈以太坊扩容 class=hanchor arialabel=Anchor>&#8983;</a></h1><p>这两天看了下以太坊扩容相关文章，囫囵吞枣、不甚理解。</p><p>简单写下小结，权当学习资料汇总了，欢迎一起探讨。</p><h2 id=背景>背景<a href=#背景 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>区块链诞生之初的一个愿景就是去中心化，要实现这一目标就需要更多节点参与到区块链的共识中来。</p><p>考虑到不同设备的计算水平不同，区块链节点类型大致可以分成三类：全节点、轻节点和SPV节点。</p><p>我们知道每个区块由区块头和这个区块所有的交易数据组成，这三种节点的区别就在于：</p><ul><li>全节点：验证所有区块的全部数据并存储的完整节点；</li><li>轻节点：仍需下载验证区块的全部数据，只需存储部分数据；</li><li>SPV节点：只需验证并存储区块头数据。</li></ul><p>PS：</p><ul><li><a href=https://www.reddit.com/r/CryptoTechnology/comments/8eft7h/spv_wallets_vs_api_wallets/>https://www.reddit.com/r/CryptoTechnology/comments/8eft7h/spv_wallets_vs_api_wallets/</a></li></ul><h2 id=扩容方案>扩容方案<a href=#扩容方案 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>为了解决日益严重的交易费和吞吐量低下问题，以太坊的扩容途径主要有两种：</p><ul><li>直接提高区块链交易吞吐量<ul><li>增大区块容量，区块验证对节点设备要求提高，逐渐变得中心化；</li><li>缩短区块产生时间，分叉概率提高。</li></ul></li><li>重构以太坊架构<ul><li>分层<ul><li>State channels</li><li>Plasma</li><li>Rollup</li></ul></li><li>分片<ul><li>Sharding</li><li>Danksharding && crList</li></ul></li></ul></li></ul><p><del>PS：POW和POS的主要区别不在于交易吞吐量，而是出于<a href=https://vitalik.ca/general/2020/11/06/pos2020.html>环保、安全</a>等方面的考虑。</del><br>PS：POS机制是分片的基础，在POW中由于矿工不需要质押，很容易在分片中作恶，无法对矿工进行实际惩处；通过POS质押可以直接扣除作恶提议者的资金，确保分片的安全性。</p><h2 id=分层>分层<a href=#分层 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>方案一的缺点已经说明，我们下面来分析方案二，我们先了解下分层的概念：</p><p>不必将所有交易放在以太坊主网上，而是在 Layer2 层执行大部分交易；L1层只需执行两个任务：处理存取款和验证L2交易的有效性，减轻L1负担，提高交易处理效率。</p><p>分层的方案大致可以分为三类，前两种是「完全的」Layer2 方案，它们试图将数据和计算都转移至链下，但由于 owner 问题，无法兼容所有的EVM应用；</p><p>而Rollup 是一种「混合」的 Layer2 方案，将计算以及状态存储转移至链下，但同时将每笔交易的部分数据保留在链上。</p><p>PS：</p><ul><li><a href=https://vitalik.ca/general/2021/01/05/rollup.html>https://vitalik.ca/general/2021/01/05/rollup.html</a></li></ul><h2 id=数据可用性da>数据可用性（DA）<a href=#数据可用性da class=hanchor arialabel=Anchor>&#8983;</a></h2><p>我们上面所说的这些交易验证都是基于SPV证明，那么问题来了，SPV节点如何知道区块头的数据是正确的呢？又要如何验证Rollup数据的置信度呢？ 这便是数据可用性问题。解决方案主要有两种：</p><ul><li>欺诈性证明：依赖于随机采样证明或可信节点的警报；</li><li>有效性证明：数据中就包含有相关证明</li></ul><p>Rollup因此也分为两类：</p><ul><li>Optimistic rollup，采用欺诈性证明，惰性计算，优化计算性能；</li><li>ZK rollup，采用有效性证明，只需压缩后的相关证明，优化存储性能</li></ul><p>由于目前 ZK proof 计算成本高，趋于中心化。因此前期 Optimistic rollup 可能占有一定优势，随着 ZK proof 算法的优化，ZK rollup 应该会逐渐成为主流。</p><h2 id=欺诈证明>欺诈证明<a href=#欺诈证明 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>欺诈证明主要依赖于 SPV节点 和 全节点 两部分。</p><p>对于全节点来讲：</p><ul><li>通过激励来鼓励它们举报坏家伙们</li><li>通过惩罚来限制它们进行警报的DOS攻击</li></ul><p>但有时全节点是无法确定是欺诈的，比如矿工广播区块头和tx1外的所有交易数据，由于不可归因的性质，全节点无法证明tx1不可用。</p><p>利用纠删码技术，我们可以将n块数据扩展为2n块数据，任意的n块数据都可以恢复原始数据块。除非矿工隐藏一半以上的数据，否则全节点可以保证能拿到所有数据。</p><p>对于SPV节点来讲：</p><ul><li>通过历史数据等验证区块头数据的正确性（如无效、双花等问题）</li><li>通过随机采样等验证全节点知道该区块头对应的所有交易数据</li></ul><p>PS：</p><ul><li><a href=https://polygon.technology/blog/the-data-availability-problem-6b74b619ffcc>https://polygon.technology/blog/the-data-availability-problem-6b74b619ffcc</a></li><li><a href=https://www.truthcoin.info/blog/fraud-proofs/>https://www.truthcoin.info/blog/fraud-proofs/</a></li></ul><h2 id=有效证明>有效证明<a href=#有效证明 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>上面提到了通过纠删码技术，可以避免矿工隐藏某些交易，但这项技术仍需要依赖一个可信的全节点； 而且如果优化不好，一些欺诈证明的大小可能与区块本身的大小差不多，这个问题可以采用多维纠删码技术来改进。</p><p>而通过 KZG的多项式承诺，我们可以生成一个有效性证明，从而使SPV节点跳过欺诈证明。</p><p>当然除此之外，还有Coded Merkle Tree、Coded Interleaving Tree、FRI等技术。</p><p>PS：</p><ul><li><a href=https://dankradfeist.de/ethereum/2020/06/16/kate-polynomial-commitments.html>https://dankradfeist.de/ethereum/2020/06/16/kate-polynomial-commitments.html</a></li></ul><h2 id=分片>分片<a href=#分片 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>分片就是将主链拆分成多个拥有单独共识机制的分片，全节点无需再同步验证所有交易数据，只需处理分片内的交易。同时为了保证安全性，信标链（Beacon）每隔一段时间会将验证者随机分配给各个分片。</p><p>Danksharding 区别于传统的分片技术，首先采用PBS（proposer builder separation）策略将 proposer 和 builder 分离，来避免矿工（既是 proposer 又是 builder）审查交易内容，获取MEV。</p><p>传统分片技术中，每个分片都有各自的 proposer 和 builder，每个分片打包的 shard block 聚合成最终的 execution block。当有一个 shard block 作恶不可用时，整个execution block都会不可用。</p><p>在 Danksharding 架构中，每个分片的 proposer 只需要广播可执行交易，由执行层的 builder 同时负责打包 shard block 和 execution block。</p><p>而 crList（Censorship resistance）类似于 flashbot，可以确保区块按 proposer 提交的交易列表打包，以免 builder 任意审查交易数据，获取MEV；与后者的区别在于 crList 是公开的交易列表。</p><p>PS：</p><ul><li><a href=https://notes.ethereum.org/@hww/workshop_feb_2022>https://notes.ethereum.org/@hww/workshop_feb_2022</a></li><li><a href=https://notes.ethereum.org/Dh7NaB59TnuUW5545msDJQ?view>https://notes.ethereum.org/Dh7NaB59TnuUW5545msDJQ?view</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>阅读其它文章</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=../../post/%E8%B7%A8%E9%93%BE--%E9%93%BE%E6%8E%A5%E4%BF%A1%E6%81%AF%E5%AD%A4%E5%B2%9B%E7%9A%84%E6%A1%A5%E6%A2%81/><span class=button__icon>←</span>
<span class=button__text>跨链 -- 链接信息孤岛的桥梁</span></a></span>
<span class="button next"><a href=../../post/%E9%9B%B6%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E/><span class=button__text>零知识学习零知识证明</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=../../assets/main.js></script>
<script src=../../assets/prism.js></script>
<script src=../../assets/colorful.js></script></div></body></html>